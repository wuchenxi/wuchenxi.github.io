<!DOCTYPE html>
<html>
<body>

<canvas id="myCanvas" width="600" height="400"
style="border:1px solid #000000;">
</canvas>
<textarea id="code" rows="10" cols="100">
pic.start(300, 400, 0);
var a=30;
function x(d){
  if(d>0){f(d-1);pic.turn(a);pic.sub();pic.sub();x(d-1);pic.esub();pic.turn(-a);x(d-1);pic.esub();pic.turn(-a);f(d-1);pic.sub();pic.turn(-a);f(d-1);x(d-1);pic.esub();pic.turn(a);x(d-1);}
}
function f(d){
  if(d>0){f(d-1);f(d-1);}
  else{pic.mv(2);}
}
x(6);
</textarea>
<p><button type="button" onclick="drawCode();">Draw</button><button type="button" onclick="clearcvs();">Clear</button></p>
<p>pic.mv(20): move ahead 20 pixels.</p>
<p>pic.turn(30): turn 30 degrees clockwise. </p>
<p>pic.sub(): remember the current location and direction. </p>
<p>pic.esub(): use the previously remembered location and direction. </p>
<p>pic.start(300,400,0): set starting point at (300, 400), initial direction as upwards.</p>
<script>

  
  function exec(obj, pic){
      return Function('"use strict"; return(function(pic){'+obj+'})')()(
	  pic
      );
  }

  function clearcvs(){
      var cvs=document.getElementById("myCanvas");
      var ctx=cvs.getContext("2d");
      ctx.clearRect(0, 0, cvs.width, cvs.height);
  }
  function drawCode(){
      var cvs=document.getElementById("myCanvas");
      var ctx=cvs.getContext("2d");
      ctx.beginPath();
      let pic={
	  context: ctx,
	  curx: 0,
	  cury: 0,
	  curdir: 0,
	  stack: [],
	  start: function(x, y, a){
	      pic.curx=x;
	      pic.cury=y;
	      pic.curdir=a*2*Math.PI/360;
	  },
	  mv : function(d){
	      var dx=Math.sin(pic.curdir);
	      var dy=Math.cos(pic.curdir);
	      pic.context.moveTo(pic.curx, pic.cury);
	      pic.context.lineTo(pic.curx+dx*d,pic.cury-dy*d);
	      pic.context.stroke();
	      pic.curx=pic.curx+dx*d;
	      pic.cury=pic.cury-dy*d;
	  },
	  turn : function(a){
	      pic.curdir=pic.curdir+a*2*Math.PI/360;
	  },
	  sub : function(){
	      pic.stack.push([pic.curx, pic.cury, pic.curdir]);
	  },
	  esub : function(){
	      var v=pic.stack.pop();
	      pic.curx=v[0];
	      pic.cury=v[1];
	      pic.curdir=v[2];
	  }
      }
      var inputVal=document.getElementById("code").value;
      exec(inputVal, pic);
}
</script>

</body>
</html>
