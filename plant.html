<!DOCTYPE html>
<html>
<body>
<p>
<canvas id="myCanvas" width="800" height="600"
style="border:1px solid #000000;">
</canvas>
</p>
<p>
<textarea id="code" rows="10" cols="100">
init(400, 500, 0);
color("#00FF00");
var a=20;
function x(d){
  if(d>0){f(d-1);turn(a);sub();sub();x(d-1);esub();turn(-a);x(d-1);esub();turn(-a);f(d-1);sub();turn(-a);f(d-1);x(d-1);esub();turn(a);x(d-1);}
}
function f(d){
  if(d>0){f(d-1);f(d-1);}
  else{fwd(3);}
}
var t0=performance.now();
x(6);
var t1=performance.now();
alert("Done in "+(t1-t0)+" ms");
</textarea>
</p>
<p><button type="button" onclick="drawCode();">Draw</button><button type="button" onclick="clearcvs();">Clear</button></p>
<p>fwd(20): move ahead 20 pixels.</p>
<p>turn(30): turn 30 degrees clockwise. </p>
<p>sub(): remember the current location and direction. </p>
<p>esub(): use the previously remembered location and direction. </p>
<p>init(300,400,0): set starting point at (300, 400), initial direction as upwards.</p>
<p>color("#00FF00"): set color to green</p>
<script>

  

  function clearcvs(){
      var cvs=document.getElementById("myCanvas");
      var ctx=cvs.getContext("2d");
      ctx.clearRect(0, 0, cvs.width, cvs.height);
  }
  function drawCode(){
      var cvs=document.getElementById("myCanvas");
      var ctx=cvs.getContext("2d");
      ctx.beginPath();
      let pic={
	  context: ctx,
	  curx: 0,
	  cury: 0,
	  curdir: 0,
	  stack: [],
	  init : function(x, y, a){
	      pic.curx=x;
	      pic.cury=y;
	      pic.curdir=a*2*Math.PI/360;
	  },
	  fwd : function(d){
	      var dx=Math.sin(pic.curdir);
	      var dy=Math.cos(pic.curdir);
	      pic.context.moveTo(pic.curx, pic.cury);
	      pic.context.lineTo(pic.curx+dx*d,pic.cury-dy*d);
	      pic.context.stroke();
	      pic.curx=pic.curx+dx*d;
	      pic.cury=pic.cury-dy*d;
	  },
	  turn : function(a){
	      pic.curdir=pic.curdir+a*2*Math.PI/360;
	  },
	  sub : function(){
	      pic.stack.push([pic.curx, pic.cury, pic.curdir]);
	  },
	  esub : function(){
	      var v=pic.stack.pop();
	      pic.curx=v[0];
	      pic.cury=v[1];
	      pic.curdir=v[2];
	  },
	  color : function(s){
	      pic.context.strokeStyle=s;
	  }
      }
      var inputVal=document.getElementById("code").value;
      Function('"use strict"; return(function(pic, init, fwd, turn, sub, esub, color){'+inputVal+'})')()(
	  pic, pic.init, pic.fwd, pic.turn, pic.sub, pic.esub, pic.color
      );
}
</script>

</body>
</html>
